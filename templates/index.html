<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemini Health App</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f7f6;
    }
    .container {
        max-width: 700px;
        margin: 40px auto;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    .header {
        text-align: center;
        margin-bottom: 30px;
    }
    .header h1 {
        color: #333;
        font-size: 2em;
        margin: 0;
    }
    .form-container {
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
    }
    .form-container label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #555;
    }
    .form-container input[type="text"], 
    .form-container input[type="number"],
    .form-container input[type="file"],
    .form-container select {
        width: calc(100% - 22px);
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
        color: #333;
    }
    .form-container input[type="submit"] {
        background-color: #007bff;
        color: #fff;
        padding: 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        transition: background-color 0.3s;
    }
    .form-container input[type="submit"]:hover {
        background-color: #0056b3;
    }
    .response-container {
        margin-top: 20px;
        padding: 20px;
        background-color: #e9ecef;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: none;
    }
    .response-container pre {
        white-space: pre-wrap;
        font-size: 16px;
        color: #333;
    }
    .loader {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left: 4px solid #007bff;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 10px auto;
        display: none;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .response-container p {
        font-size: 16px;
        color: #333;
    }
    #download-report {
        display: none;
        background-color: #28a745;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        margin-top: 10px;
    }
    #download-report:hover {
        background-color: #218838;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gemini Health App</h1>
        </div>
        <div class="form-container">
            <form id="calorie-form" action="/calculate/" method="post" enctype="multipart/form-data">
                <label for="name">Your Name:</label>
                <input type="text" id="name" name="name" required>
                
                <label for="input">Image Input Prompt:</label>
                <input type="text" id="input" name="input" required>
                
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" required>
                
                <label for="weight">Weight (kg):</label>
                <input type="number" id="weight" name="weight" step="any" required>
                
                <label for="height">Height (cm):</label>
                <input type="number" id="height" name="height" step="any" required>
                
                <label for="meal_type">Meal Type:</label>
                <select id="meal_type" name="meal_type" required>
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                </select>
                
                <label for="file">Upload Image:</label>
                <input type="file" id="file" name="file" accept=".jpg, .jpeg, .png" required>
                
                <input type="submit" value="Submit">
                <div class="loader" id="loader"></div>
            </form>
        </div>
        
        <div class="response-container" id="response-container">
            <pre id="response-text"></pre>
            <p id="bmi"></p>
            <p id="ideal-bmi"></p>
            <button id="download-report">Download Report</button>
        </div>
    </div>

    <script>
        document.getElementById("calorie-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            let formElement = document.getElementById("calorie-form");
            let formData = new FormData(formElement);
            
            document.getElementById("loader").style.display = "inline-block";
            
            try {
                let response = await fetch("/calculate/", {
                    method: "POST",
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                let responseData = await response.json();
                displayResponse(responseData.response, responseData.bmi, responseData.ideal_bmi);
            } catch (error) {
                displayResponse("Error processing request.");
            } finally {
                document.getElementById("loader").style.display = "none";
            }
        });

        function displayResponse(response, bmi, idealBmi) {
            document.getElementById("response-container").style.display = "block";
            document.getElementById("response-text").textContent = response;
            document.getElementById("bmi").textContent = `BMI: ${bmi}`;
            document.getElementById("ideal-bmi").textContent = `Ideal BMI: ${idealBmi}`;
            
            let downloadButton = document.getElementById("download-report");
            downloadButton.style.display = "block";
            downloadButton.addEventListener("click", function() {
                downloadReport(response);
            });
        }

        function downloadReport(responseData) {
            const blob = new Blob([responseData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'gemini_health_report.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
